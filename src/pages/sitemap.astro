---
import { getCollection } from 'astro:content'

import BaseLayout from '#layouts/base-layout.astro'
import DocsLayout from '#layouts/docs-layout.astro'
import type { RouteId, RouteOptions } from 'astro-typesafe-routes/path'
import Link from '#components/link.astro'
import { type RoutesArray } from '#utils/types'
import { getApiCollection, getDataCollection } from '#utils/collections'

type SitemapLink<T extends RouteId> = RouteOptions<T> & {
  label: string
  children?: (RouteOptions<T> & { label: string })[]
}

type SitemapLinks = SitemapLink<RouteId>[]

const docsnavLinks = (await getApiCollection()).map((doc) => ({
  to: '/api-documentation/[...slug]',
  params: { slug: doc.id },
  label: doc.data.title,
})) satisfies RoutesArray<'/api-documentation/[...slug]'>
const datanavLinks = (await getDataCollection()).map((doc) => ({
  to: '/bb2-data/[...slug]',
  params: { slug: doc.id },
  label: doc.data.title,
})) satisfies RoutesArray<'/bb2-data/[...slug]'>

const sitemapLinks = [
  {
    label: 'Home',
    to: '/' as const,
    params: null,
  },
  {
    label: 'About',
    to: '/about',
    params: null,
  },
  {
    label: 'API Documentation',
    to: '/api-documentation',
    params: null,
    children: docsnavLinks,
  },
  {
    label: 'BB2 Data',
    to: '/bb2-data',
    params: null,
    children: datanavLinks,
  },
  {
    label: 'Production Access',
    to: '/production-access',
    params: null,
  },
  {
    label: 'Support',
    to: '/support',
    params: null,
  },
] satisfies SitemapLinks
---

<BaseLayout title="Sitemap" description="">
  <DocsLayout showSideNav={false}>
    <div class="margin-bottom-4">
      <h1>Sitemap</h1>
    </div>
    <div class="usa-prose">
      <ul>
        {
          sitemapLinks.map((link) => (
            <li>
              <Link to={link.to}>{link.label}</Link>

              {link?.children ? (
                <ul>
                  {link.children.map((child) => (
                    <li>
                      <Link to={child.to} params={child.params}>
                        {child.label}
                      </Link>
                    </li>
                  ))}
                </ul>
              ) : null}
            </li>
          ))
        }
      </ul>
    </div>
  </DocsLayout>
</BaseLayout>
