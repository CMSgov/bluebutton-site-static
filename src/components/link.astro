---
import LaunchSvg from '#assets/uswds/img/usa-icons/launch.svg'
import { $path } from 'astro-typesafe-routes/path'
import { button } from 'utils/cva/button'
import type { LinkProps } from 'utils/types'
import type { RouteId } from 'astro-typesafe-routes/path'

type Props<T extends RouteId> = LinkProps<T>

const props = Astro.props

let isExternal = false
let computedHref: string

if ('to' in props && props.to) {
  // Explicit internal link using "to" prop (preferred for Astro templates)
  isExternal = false
  computedHref = $path(props)
} else if ('href' in props && props.href) {
  // Handle href - could be external or internal (from MDX)
  const hrefString = props.href.toString()

  // Check if it's an external URL
  if (hrefString.startsWith('http')) {
    isExternal = true
    computedHref = hrefString
  } else {
    // Internal link (from MDX)
    isExternal = false
    computedHref = hrefString
  }
} else {
  throw new Error('Link component requires either "href" or "to" prop')
}

const { variant = 'primary', size = 'medium', showIcon = true, ...restProps } = props
---

<a
  href={computedHref}
  target={isExternal ? '_blank' : undefined}
  rel={isExternal && !computedHref?.includes('cms.gov') ? 'noopener' : undefined}
  class={button({ variant, size })}
  {...restProps}
>
  <slot />{
    isExternal && showIcon ? (
      <LaunchSvg height={16} width={16} fill="currentColor" style="vertical-align:middle;" class="margin-left-05" />
    ) : null
  }</a
>
