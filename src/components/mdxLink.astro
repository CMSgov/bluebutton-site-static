---
import LaunchSvg from "#assets/uswds/img/usa-icons/launch.svg";
import type { HTMLAttributes } from "astro/types";
import type { VariantProps } from "cva";
import { button } from "utils/cva/button";

interface Props extends HTMLAttributes<"a">, VariantProps<typeof button> {
  showIcon?: boolean;
}

const {
  href,
  showIcon = true,
  variant = "link",
  size = "medium",
  ...props
} = Astro.props;
const site = Astro.site;

let isExternal = false;
try {
  const { hostname } = new URL(href || "");
  isExternal = hostname !== site?.hostname;
} catch {
  isExternal = false;
}
---

<a
  href={href}
  target={isExternal ? "_blank" : undefined}
  rel={isExternal ? "noopener" : undefined}
  class={button({ variant, size })}
  {...props}
>
  <slot />
  {
    isExternal && showIcon ? (
      <LaunchSvg
        height={16}
        width={16}
        fill="currentColor"
        style="vertical-align:middle;"
      />
    ) : null
  }</a
>
