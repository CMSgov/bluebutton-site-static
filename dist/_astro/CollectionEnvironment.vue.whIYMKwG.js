import{d as Q,H as R,K as E,I as T,J as H,c as B,Z as te,o as _,w as f,a as d,h as X,A as q,f as K,F as Y,x as ee,l as se,S as L,a4 as P,v as oe,b as n,k as ae,$ as U,a2 as ie,N as le,_ as re,aa as J,E as ue,z as ce,W as D,i as p,a8 as ve,t as de,C as me,P as Z}from"./api.astro_astro_type_script_index_0_lang.CNbPyKW1.js";import{m as fe}from"./Draggable.vue.DbNyVWAi.js";import{w as pe}from"./DeleteSidebarListElement.vue.67KjR9Fr.js";import{C as he}from"./EditSidebarListElement.vue.C74QEdKJ.js";import{b as be}from"./ViewLayoutSection.vue.DmuGjUg0.js";import{K as ke,M as xe}from"./EnvironmentModal.vue.BOGC7Hep.js";import{x as G,H as ye}from"./DataTableHeader.vue.CkIzVKba.js";import"./CommandActionInput.vue.lZfUbM3y.js";const ge=Q({__name:"EnvironmentForm",props:{collection:{},environment:{},workspace:{},envVariables:{}},setup(c){const{collectionMutators:i}=R(),u=E([]),M=E(new Set),g=E(new Map),h=E(!1),F=T(()=>{var e;if(!((e=c.environment)!=null&&e.value))return[{key:"",value:""}];try{const a=JSON.parse(c.environment.value),r=Object.entries(a).map(([t,l])=>({key:t,value:String(l)}));return r.length===0?[{key:"",value:""}]:r}catch{return[{key:"",value:""}]}}),S=T(()=>{const e=u.value[u.value.length-1];return e?e.key||e.value?[...u.value,{key:"",value:""}]:u.value:[{key:"",value:""}]}),C=T(()=>{const e=new Map;return u.value.forEach((a,r)=>{if(a.key){const t=e.get(a.key)||[];t.push(r),e.set(a.key,t)}}),g.value.forEach((a,r)=>{if(a){const t=e.get(a)||[];t.push(r),e.set(a,t)}}),Array.from(e.values()).filter(a=>a.length>1).flat()});H(F,e=>{u.value=[...e],M.value=new Set(e.map(a=>a.key).filter(Boolean))},{immediate:!0});const N=async(e,a,r)=>{var t;if(!h.value){if(a==="key"){g.value.set(e,r);const l=new Set(M.value),b=u.value[e];if(b&&l.delete(b.key),l.has(r))return}h.value=!0;try{const l=[...u.value],b=l[e];if(!b)return;l[e]={key:a==="key"?r:b.key,value:a==="value"?r:b.value},!l[e].key&&!l[e].value&&e!==l.length-1&&l.splice(e,1);const z=l.reduce((x,{key:W,value:s})=>((W||s)&&(x[W]=s),x),{});if(c.collection){const x={...c.collection["x-scalar-environments"],[c.environment.name]:{...(t=c.collection["x-scalar-environments"])==null?void 0:t[c.environment.name],variables:z}};await i.edit(c.collection.uid,"x-scalar-environments",x)}if(e===u.value.length-1){const x=l[l.length-1];x&&(x.key||x.value)&&await m()}await J(),u.value=l,a==="key"&&(M.value=new Set(l.map(x=>x.key).filter(Boolean)),g.value.delete(e))}finally{h.value=!1}}},m=async()=>{var e;if(!h.value){h.value=!0;try{const a=[...u.value,{key:"",value:""}],r=a.reduce((t,{key:l,value:b})=>((l||b)&&(t[l]=b),t),{});if(c.collection){const t={...c.collection["x-scalar-environments"],[c.environment.name]:{...(e=c.collection["x-scalar-environments"])==null?void 0:e[c.environment.name],variables:r}};await i.edit(c.collection.uid,"x-scalar-environments",t)}await J(),u.value=a}finally{h.value=!1}}},$=async e=>{var a;if(!h.value){h.value=!0;try{const r=[...u.value];r.splice(e,1);const t=r.reduce((l,{key:b,value:z})=>((b||z)&&(l[b]=z),l),{});if(c.collection){const l={...c.collection["x-scalar-environments"],[c.environment.name]:{...(a=c.collection["x-scalar-environments"])==null?void 0:a[c.environment.name],variables:t}};await i.edit(c.collection.uid,"x-scalar-environments",l)}await J(),u.value=r}finally{h.value=!1}}},O=async()=>{if(u.value.length===0)await m();else if(u.value.length>=1){const e=u.value[u.value.length-1];e&&(e.key||e.value)&&await m()}};return te(()=>{O()}),H(()=>u.value,()=>{O()}),(e,a)=>(_(),B(re,{class:"group/table flex-1",columns:["",""]},{default:f(()=>[d(q,{class:"sr-only !block"},{default:f(()=>[d(G,null,{default:f(()=>a[0]||(a[0]=[K("Key")])),_:1,__:[0]}),d(G,null,{default:f(()=>a[1]||(a[1]=[K("Value")])),_:1,__:[1]})]),_:1}),(_(!0),X(Y,null,ee(S.value,(r,t)=>(_(),B(q,{key:t,class:se({error:C.value.includes(t)})},{default:f(()=>[d(L,null,{default:f(()=>[d(P,{disableCloseBrackets:"",disableEnter:"",disableTabIndent:"",lineWrapping:"",environment:e.environment,envVariables:e.envVariables,modelValue:r.key,placeholder:"Key",workspace:e.workspace,"onUpdate:modelValue":l=>N(t,"key",l)},oe({_:2},[C.value.includes(t)?{name:"icon",fn:f(()=>[d(n(ye),{class:"text-red mr-0.75 size-3.5 brightness-[.9]"})]),key:"0"}:void 0]),1032,["environment","envVariables","modelValue","workspace","onUpdate:modelValue"])]),_:2},1024),d(L,null,{default:f(()=>[d(P,{class:"pr-6 group-hover:pr-10 group-has-[.cm-focused]:pr-10",disableCloseBrackets:"",disableEnter:"",disableTabIndent:"",lineWrapping:"",environment:e.environment,envVariables:e.envVariables,modelValue:r.value,placeholder:"Value",workspace:e.workspace,"onUpdate:modelValue":l=>N(t,"value",l)},{icon:f(()=>[r.key||r.value?(_(),B(n(U),{key:0,class:"text-c-2 hover:text-c-1 hover:bg-b-2 z-context hidden h-fit rounded p-1 group-hover:flex group-has-[.cm-focused]:flex",size:"sm",variant:"ghost",onClick:ie(l=>$(t),["stop"])},{default:f(()=>[d(n(le),{class:"size-3.5"})]),_:2},1032,["onClick"])):ae("",!0)]),_:2},1032,["environment","envVariables","modelValue","workspace","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1}))}}),we=ue(ge,[["__scopeId","data-v-83bfcc8a"]]),_e={class:"flex h-full w-full flex-col gap-12 px-1.5 pt-8"},Ce={class:"flex flex-col gap-4"},Ve={class:"rounded-lg border"},Ee={class:"bg-b-2 flex cursor-grab items-center justify-between rounded-t-lg px-1 py-1 text-sm"},Fe={class:"flex items-center"},Se=["onClick"],$e={class:"text-c-3 flex h-full items-center justify-center rounded-lg border p-4"},Ae=Q({__name:"CollectionEnvironment",setup(c){const{activeCollection:i,activeWorkspace:u,activeEnvVariables:M}=ce(),{collectionMutators:g}=R(),h=D(),F=D(),S=D(),C=D(),N=E(""),m=E(null),$=E(void 0),O=T(()=>{var s;return(s=i.value)!=null&&s["x-scalar-environments"]?Object.entries(i.value["x-scalar-environments"]).map(([o,k])=>({uid:o,name:o,value:JSON.stringify(k.variables||{}),color:k.color||"#FFFFFF"})):[]}),e=()=>{var s;!((s=i.value)!=null&&s.uid)||!m.value||(g.removeEnvironment(m.value,i.value.uid),F.hide())},a=s=>{m.value=s,F.show()},r=s=>{var o;(o=i.value)!=null&&o.uid&&(g.addEnvironment(s.name,{variables:{},color:s.color},i.value.uid),S.hide())},t=s=>{m.value=s.name,N.value=s.color||"#FFFFFF",h.show()},l=s=>{var o,k,v;if(!((o=i.value)!=null&&o.uid)||!m.value)return;const y={...i.value["x-scalar-environments"],[m.value]:{variables:((v=(k=i.value["x-scalar-environments"])==null?void 0:k[m.value])==null?void 0:v.variables)||{},color:s}};g.edit(i.value.uid,"x-scalar-environments",y),h.hide()},b=s=>{m.value=s,$.value=s,C.show()},z=()=>{m.value=null,$.value=void 0,C.hide()},x=s=>{var o;if(!((o=i.value)!=null&&o.uid)||!m.value)return;const k={...i.value["x-scalar-environments"]};if(!k[m.value])return;const v={},y=Object.entries(k),w=y.findIndex(([V])=>V===m.value);y.forEach(([V,j],A)=>{A===w?v[s]=j:v[V]=j}),g.edit(i.value.uid,"x-scalar-environments",v),m.value=null,$.value=void 0,C.hide()},W=(s,o)=>{var k;if(!((k=i.value)!=null&&k.uid))return;const v={...i.value["x-scalar-environments"]},y={},w=Object.entries(v),V=w.findIndex(([I])=>I===s.id),j=w.findIndex(([I])=>I===o.id);if(V===-1||j===-1)return;const A=w[V];A&&(w.splice(V,1),w.splice(j,0,A),w.forEach(([I,ne])=>{y[I]=ne}),g.edit(i.value.uid,"x-scalar-environments",y))};return(s,o)=>(_(),B(be,null,{default:f(()=>{var k;return[p("div",_e,[p("div",Ce,[o[5]||(o[5]=p("div",{class:"flex items-start justify-between gap-2"},[p("div",{class:"flex flex-col gap-2"},[p("div",{class:"flex h-8 items-center"},[p("h3",{class:"font-bold"},"Environment Variables")]),p("p",{class:"text-sm"},[K(" Set environment variables at your collection level. Use "),p("code",{class:"font-code text-c-2"},"{{ variable }}"),K(" to add / search among the selected environment's variables in your request inputs. ")])])],-1)),(_(!0),X(Y,null,ee(O.value,v=>(_(),B(n(fe),{key:v.name,id:v.name,isDraggable:!0,isDroppable:!0,parentIds:[],onOnDragEnd:W},{default:f(()=>[p("div",Ve,[p("div",Ee,[p("div",Fe,[d(n(U),{class:"hover:bg-b-3 flex h-6 w-6 p-1",onClick:y=>t(v),variant:"ghost"},{default:f(()=>[p("span",{style:ve({backgroundColor:v.color||"#FFFFFF"}),class:"h-2.5 w-2.5 rounded-full"},null,4)]),_:2},1032,["onClick"]),p("button",{class:"hover:bg-b-3 rounded px-1 py-0.5 text-sm",onClick:y=>b(v.name)},de(v.name),9,Se)]),d(n(U),{class:"hover:bg-b-3 hover:text-c-1 h-fit p-1.25",variant:"ghost",onClick:y=>a(v.name)},{default:f(()=>[d(n(le),{class:"size-3.5"})]),_:2},1032,["onClick"])]),n(i)&&n(u)?(_(),B(we,{key:0,collection:n(i),environment:v,envVariables:n(M),workspace:n(u)},null,8,["collection","environment","envVariables","workspace"])):ae("",!0)])]),_:2},1032,["id"]))),128)),p("div",$e,[d(n(U),{class:"hover:bg-b-2 hover:text-c-1 flex items-center gap-2",size:"sm",variant:"ghost",onClick:o[0]||(o[0]=v=>n(S).show())},{default:f(()=>[d(n(me),{class:"inline-flex",icon:"Add",size:"sm",thickness:"1.5"}),o[4]||(o[4]=p("span",null,"Add Environment",-1))]),_:1,__:[4]})])]),d(n(Z),{size:"xxs",state:n(F),title:`Delete ${m.value||"Environment"}`},{default:f(()=>[d(pe,{variableName:"Environment",warningMessage:"Are you sure you want to delete this environment? This action cannot be undone.",onClose:o[1]||(o[1]=v=>n(F).hide()),onDelete:e})]),_:1},8,["state","title"]),d(ke,{activeWorkspaceCollections:n(i)?[n(i)]:[],collectionId:(k=n(i))==null?void 0:k.uid,state:n(S),onCancel:o[2]||(o[2]=v=>n(S).hide()),onSubmit:r},null,8,["activeWorkspaceCollections","collectionId","state"]),d(xe,{selectedColor:N.value,state:n(h),onCancel:o[3]||(o[3]=v=>n(h).hide()),onSubmit:l},null,8,["selectedColor","state"]),d(n(Z),{size:"xxs",state:n(C),title:`Edit ${m.value}`},{default:f(()=>[d(he,{name:$.value??"",onClose:z,onEdit:x},null,8,["name"])]),_:1},8,["state","title"])])]}),_:1}))}});export{Ae as default};
