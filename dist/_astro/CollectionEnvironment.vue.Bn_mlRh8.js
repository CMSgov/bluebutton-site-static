import{d as G,B as P,f as E,R as T,D as J,k as B,i as te,o as _,T as f,j as d,c as X,aO as L,Y as K,U as Z,V as ee,z as se,aQ as R,aL as H,ao as oe,u as n,a as ae,$ as U,q as ie,aR as le,aS as re,a5 as q,ae as ue,A as ce,a6 as A,b as p,aD as ve,y as de,a0 as me,ac as Q}from"./api.astro_astro_type_script_index_0_lang.NHHQh0jI.js";import{m as fe}from"./Draggable.vue.BSoxC0L5.js";import{w as pe}from"./DeleteSidebarListElement.vue.DuguaE32.js";import{C as he}from"./EditSidebarListElement.vue.DfHLE21D.js";import{b as be}from"./ViewLayoutSection.vue.M-wu7EC7.js";import{K as ke,M as ye}from"./EnvironmentModal.vue.BvuM86sG.js";import{x as Y,H as xe}from"./DataTableHeader.vue.DJAV6W3R.js";import"./CommandActionInput.vue.B0bK6_ap.js";const ge=G({__name:"EnvironmentForm",props:{collection:{},environment:{},workspace:{},envVariables:{}},setup(c){const{collectionMutators:i}=P(),u=E([]),j=E(new Set),g=E(new Map),h=E(!1),F=T(()=>{var e;if(!((e=c.environment)!=null&&e.value))return[{key:"",value:""}];try{const a=JSON.parse(c.environment.value),r=Object.entries(a).map(([t,l])=>({key:t,value:String(l)}));return r.length===0?[{key:"",value:""}]:r}catch{return[{key:"",value:""}]}}),S=T(()=>{const e=u.value[u.value.length-1];return e?e.key||e.value?[...u.value,{key:"",value:""}]:u.value:[{key:"",value:""}]}),C=T(()=>{const e=new Map;return u.value.forEach((a,r)=>{if(a.key){const t=e.get(a.key)||[];t.push(r),e.set(a.key,t)}}),g.value.forEach((a,r)=>{if(a){const t=e.get(a)||[];t.push(r),e.set(a,t)}}),Array.from(e.values()).filter(a=>a.length>1).flat()});J(F,e=>{u.value=[...e],j.value=new Set(e.map(a=>a.key).filter(Boolean))},{immediate:!0});const M=async(e,a,r)=>{var t;if(!h.value){if(a==="key"){g.value.set(e,r);const l=new Set(j.value),b=u.value[e];if(b&&l.delete(b.key),l.has(r))return}h.value=!0;try{const l=[...u.value],b=l[e];if(!b)return;l[e]={key:a==="key"?r:b.key,value:a==="value"?r:b.value},!l[e].key&&!l[e].value&&e!==l.length-1&&l.splice(e,1);const $=l.reduce((y,{key:I,value:s})=>((I||s)&&(y[I]=s),y),{});if(c.collection){const y={...c.collection["x-scalar-environments"],[c.environment.name]:{...(t=c.collection["x-scalar-environments"])==null?void 0:t[c.environment.name],variables:$}};await i.edit(c.collection.uid,"x-scalar-environments",y)}if(e===u.value.length-1){const y=l[l.length-1];y&&(y.key||y.value)&&await m()}await q(),u.value=l,a==="key"&&(j.value=new Set(l.map(y=>y.key).filter(Boolean)),g.value.delete(e))}finally{h.value=!1}}},m=async()=>{var e;if(!h.value){h.value=!0;try{const a=[...u.value,{key:"",value:""}],r=a.reduce((t,{key:l,value:b})=>((l||b)&&(t[l]=b),t),{});if(c.collection){const t={...c.collection["x-scalar-environments"],[c.environment.name]:{...(e=c.collection["x-scalar-environments"])==null?void 0:e[c.environment.name],variables:r}};await i.edit(c.collection.uid,"x-scalar-environments",t)}await q(),u.value=a}finally{h.value=!1}}},z=async e=>{var a;if(!h.value){h.value=!0;try{const r=[...u.value];r.splice(e,1);const t=r.reduce((l,{key:b,value:$})=>((b||$)&&(l[b]=$),l),{});if(c.collection){const l={...c.collection["x-scalar-environments"],[c.environment.name]:{...(a=c.collection["x-scalar-environments"])==null?void 0:a[c.environment.name],variables:t}};await i.edit(c.collection.uid,"x-scalar-environments",l)}await q(),u.value=r}finally{h.value=!1}}},O=async()=>{if(u.value.length===0)await m();else if(u.value.length>=1){const e=u.value[u.value.length-1];e&&(e.key||e.value)&&await m()}};return te(()=>{O()}),J(()=>u.value,()=>{O()}),(e,a)=>(_(),B(re,{class:"group/table flex-1",columns:["",""]},{default:f(()=>[d(L,{class:"sr-only !block"},{default:f(()=>[d(Y,null,{default:f(()=>a[0]||(a[0]=[K("Key")])),_:1,__:[0]}),d(Y,null,{default:f(()=>a[1]||(a[1]=[K("Value")])),_:1,__:[1]})]),_:1}),(_(!0),X(Z,null,ee(S.value,(r,t)=>(_(),B(L,{key:t,class:se({error:C.value.includes(t)})},{default:f(()=>[d(R,null,{default:f(()=>[d(H,{disableCloseBrackets:"",disableEnter:"",disableTabIndent:"",lineWrapping:"",environment:e.environment,envVariables:e.envVariables,modelValue:r.key,placeholder:"Key",workspace:e.workspace,"onUpdate:modelValue":l=>M(t,"key",l)},oe({_:2},[C.value.includes(t)?{name:"icon",fn:f(()=>[d(n(xe),{class:"text-red mr-0.75 size-3.5 brightness-[.9]"})]),key:"0"}:void 0]),1032,["environment","envVariables","modelValue","workspace","onUpdate:modelValue"])]),_:2},1024),d(R,null,{default:f(()=>[d(H,{class:"pr-6 group-hover:pr-10 group-has-[.cm-focused]:pr-10",disableCloseBrackets:"",disableEnter:"",disableTabIndent:"",lineWrapping:"",environment:e.environment,envVariables:e.envVariables,modelValue:r.value,placeholder:"Value",workspace:e.workspace,"onUpdate:modelValue":l=>M(t,"value",l)},{icon:f(()=>[r.key||r.value?(_(),B(n(U),{key:0,class:"text-c-2 hover:text-c-1 hover:bg-b-2 z-context hidden h-fit rounded p-1 group-hover:flex group-has-[.cm-focused]:flex",size:"sm",variant:"ghost",onClick:ie(l=>z(t),["stop"])},{default:f(()=>[d(n(le),{class:"size-3.5"})]),_:2},1032,["onClick"])):ae("",!0)]),_:2},1032,["environment","envVariables","modelValue","workspace","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1}))}}),we=ue(ge,[["__scopeId","data-v-83bfcc8a"]]),_e={class:"flex h-full w-full flex-col gap-12 px-1.5 pt-8"},Ce={class:"flex flex-col gap-4"},Ve={class:"rounded-lg border"},Ee={class:"bg-b-2 flex cursor-grab items-center justify-between rounded-t-lg px-1 py-1 text-sm"},Fe={class:"flex items-center"},Se=["onClick"],ze={class:"text-c-3 flex h-full items-center justify-center rounded-lg border p-4"},We=G({__name:"CollectionEnvironment",setup(c){const{activeCollection:i,activeWorkspace:u,activeEnvVariables:j}=ce(),{collectionMutators:g}=P(),h=A(),F=A(),S=A(),C=A(),M=E(""),m=E(null),z=E(void 0),O=T(()=>{var s;return(s=i.value)!=null&&s["x-scalar-environments"]?Object.entries(i.value["x-scalar-environments"]).map(([o,k])=>({uid:o,name:o,value:JSON.stringify(k.variables||{}),color:k.color||"#FFFFFF"})):[]}),e=()=>{var s;!((s=i.value)!=null&&s.uid)||!m.value||(g.removeEnvironment(m.value,i.value.uid),F.hide())},a=s=>{m.value=s,F.show()},r=s=>{var o;(o=i.value)!=null&&o.uid&&(g.addEnvironment(s.name,{variables:{},color:s.color},i.value.uid),S.hide())},t=s=>{m.value=s.name,M.value=s.color||"#FFFFFF",h.show()},l=s=>{var o,k,v;if(!((o=i.value)!=null&&o.uid)||!m.value)return;const x={...i.value["x-scalar-environments"],[m.value]:{variables:((v=(k=i.value["x-scalar-environments"])==null?void 0:k[m.value])==null?void 0:v.variables)||{},color:s}};g.edit(i.value.uid,"x-scalar-environments",x),h.hide()},b=s=>{m.value=s,z.value=s,C.show()},$=()=>{m.value=null,z.value=void 0,C.hide()},y=s=>{var o;if(!((o=i.value)!=null&&o.uid)||!m.value)return;const k={...i.value["x-scalar-environments"]};if(!k[m.value])return;const v={},x=Object.entries(k),w=x.findIndex(([V])=>V===m.value);x.forEach(([V,D],W)=>{W===w?v[s]=D:v[V]=D}),g.edit(i.value.uid,"x-scalar-environments",v),m.value=null,z.value=void 0,C.hide()},I=(s,o)=>{var k;if(!((k=i.value)!=null&&k.uid))return;const v={...i.value["x-scalar-environments"]},x={},w=Object.entries(v),V=w.findIndex(([N])=>N===s.id),D=w.findIndex(([N])=>N===o.id);if(V===-1||D===-1)return;const W=w[V];W&&(w.splice(V,1),w.splice(D,0,W),w.forEach(([N,ne])=>{x[N]=ne}),g.edit(i.value.uid,"x-scalar-environments",x))};return(s,o)=>(_(),B(be,null,{default:f(()=>{var k;return[p("div",_e,[p("div",Ce,[o[5]||(o[5]=p("div",{class:"flex items-start justify-between gap-2"},[p("div",{class:"flex flex-col gap-2"},[p("div",{class:"flex h-8 items-center"},[p("h3",{class:"font-bold"},"Environment Variables")]),p("p",{class:"text-sm"},[K(" Set environment variables at your collection level. Use "),p("code",{class:"font-code text-c-2"},"{{ variable }}"),K(" to add / search among the selected environment's variables in your request inputs. ")])])],-1)),(_(!0),X(Z,null,ee(O.value,v=>(_(),B(n(fe),{key:v.name,id:v.name,isDraggable:!0,isDroppable:!0,parentIds:[],onOnDragEnd:I},{default:f(()=>[p("div",Ve,[p("div",Ee,[p("div",Fe,[d(n(U),{class:"hover:bg-b-3 flex h-6 w-6 p-1",onClick:x=>t(v),variant:"ghost"},{default:f(()=>[p("span",{style:ve({backgroundColor:v.color||"#FFFFFF"}),class:"h-2.5 w-2.5 rounded-full"},null,4)]),_:2},1032,["onClick"]),p("button",{class:"hover:bg-b-3 rounded px-1 py-0.5 text-sm",onClick:x=>b(v.name)},de(v.name),9,Se)]),d(n(U),{class:"hover:bg-b-3 hover:text-c-1 h-fit p-1.25",variant:"ghost",onClick:x=>a(v.name)},{default:f(()=>[d(n(le),{class:"size-3.5"})]),_:2},1032,["onClick"])]),n(i)&&n(u)?(_(),B(we,{key:0,collection:n(i),environment:v,envVariables:n(j),workspace:n(u)},null,8,["collection","environment","envVariables","workspace"])):ae("",!0)])]),_:2},1032,["id"]))),128)),p("div",ze,[d(n(U),{class:"hover:bg-b-2 hover:text-c-1 flex items-center gap-2",size:"sm",variant:"ghost",onClick:o[0]||(o[0]=v=>n(S).show())},{default:f(()=>[d(n(me),{class:"inline-flex",icon:"Add",size:"sm",thickness:"1.5"}),o[4]||(o[4]=p("span",null,"Add Environment",-1))]),_:1,__:[4]})])]),d(n(Q),{size:"xxs",state:n(F),title:`Delete ${m.value||"Environment"}`},{default:f(()=>[d(pe,{variableName:"Environment",warningMessage:"Are you sure you want to delete this environment? This action cannot be undone.",onClose:o[1]||(o[1]=v=>n(F).hide()),onDelete:e})]),_:1},8,["state","title"]),d(ke,{activeWorkspaceCollections:n(i)?[n(i)]:[],collectionId:(k=n(i))==null?void 0:k.uid,state:n(S),onCancel:o[2]||(o[2]=v=>n(S).hide()),onSubmit:r},null,8,["activeWorkspaceCollections","collectionId","state"]),d(ye,{selectedColor:M.value,state:n(h),onCancel:o[3]||(o[3]=v=>n(h).hide()),onSubmit:l},null,8,["selectedColor","state"]),d(n(Q),{size:"xxs",state:n(C),title:`Edit ${m.value}`},{default:f(()=>[d(he,{name:z.value??"",onClose:$,onEdit:y},null,8,["name"])]),_:1},8,["state","title"])])]}),_:1}))}});export{We as default};
