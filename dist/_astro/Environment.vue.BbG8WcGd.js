import{d as me,U as fe,X as pe,z as xe,H as be,Y as he,W as z,K as _,I as ke,J as G,V as s,Z as ye,a0 as ge,c as V,o as y,w as b,a as d,f as J,i as C,h as R,b as i,F as L,x as X,a1 as Ce,l as Y,C as Z,t as q,k as H,a2 as Ee,$ as we,a3 as $e,v as Ie,a4 as De,P as _e,a5 as Oe}from"./api.astro_astro_type_script_index_0_lang.CNbPyKW1.js";import{d as je}from"./LibraryIcon.vue.zvQbyoa7.js";import{C as Ve}from"./EditSidebarListElement.vue.C74QEdKJ.js";import{m as Fe,g as Me}from"./SidebarButton.vue.SPr50Aqr.js";import{_ as Ne,p as P}from"./SidebarListElement.vue.DR1_dVF6.js";import{u as Se}from"./ViewLayout.vue.CcFhHc6G.js";import{x as We}from"./ViewLayoutContent.vue.De4S4SxL.js";import{b as ze}from"./ViewLayoutSection.vue.DmuGjUg0.js";import{M as Re,K as Be}from"./EnvironmentModal.vue.BOGC7Hep.js";import"./DeleteSidebarListElement.vue.67KjR9Fr.js";import"./ScalarHotkey.vue.Cwc2H84h.js";import"./Draggable.vue.DbNyVWAi.js";import"./CommandActionInput.vue.lZfUbM3y.js";function Ke(B,g){return{handleDragEnd:(m,c)=>{if(!m||!c)return;const{id:O,parentId:v}=m,{id:S,parentId:F,offset:W}=c;if(v!==F)return;const u=B.value.find(f=>f.uid===v);if(!u||!u["x-scalar-environments"])return;const h=u["x-scalar-environments"],x=Object.keys(h);({...h});const E=x.findIndex(f=>f===O);x.splice(E,1);const w=x.findIndex(f=>f===S)+(W===1?1:0);x.splice(w,0,O);const $=x.reduce((f,r)=>{const j=h[r];return j&&(f[r]=j),f},{});u["x-scalar-environments"]=$,g.edit(u.uid,"x-scalar-environments",u["x-scalar-environments"])},isDroppable:(m,c)=>m.parentId===c.parentId}}const Ae={class:"flex-1"},Ue=["onClick"],Ge={class:"flex h-5 max-w-[14px] items-center justify-center"},ln=me({__name:"Environment",setup(B){const g=fe(),m=pe(),{activeWorkspace:c,activeEnvironment:O,activeWorkspaceCollections:v,activeEnvVariables:S}=xe(),{events:F,workspaceMutators:W,collectionMutators:u}=be(),{collapsedSidebarFolders:h,toggleSidebarFolder:x}=he(),E=z(),w=z(),$=z(),f=_(null),r=_("default"),j=_(""),I=_(void 0),k=_(void 0),M=_(void 0),{toast:K}=Oe(),Q=e=>JSON.parse(e);function A(e,n,a){var l;e&&(n.uid===a?K(`Environment name already used in ${(l=n.info)==null?void 0:l.title}`,"error"):K("Environment name already used in another collection","error"))}const D=ke(()=>v.value.filter(e=>{var n;return((n=e.info)==null?void 0:n.title)!=="Drafts"}));function T(e){D.value.some(n=>{const a=Object.keys(n["x-scalar-environments"]||{}).includes(e.name);return A(a,n,e.collectionId),a})||(e.collectionId&&(u.addEnvironment(e.name,{variables:{},color:e.color},e.collectionId),h[e.collectionId]||x(e.collectionId),g.push({name:"environment.collection",params:{[s.Collection]:e.collectionId,[s.Environment]:e.name}})),w.hide())}function ee(e){var n,a;if(!O)return;const l=Q(e);if(r.value==="default")W.edit((n=c.value)==null?void 0:n.uid,"environments",l);else{const t=v.value.find(o=>{var p;return(p=o["x-scalar-environments"])==null?void 0:p[r.value??""]});if((a=t?.["x-scalar-environments"])!=null&&a[r.value??""]){const o=t["x-scalar-environments"][r.value??""];o&&(o.variables=l,u.edit(t.uid,"x-scalar-environments",t["x-scalar-environments"]))}}}const N=e=>{I.value=e,w.show()},ne=(e,n)=>{k.value=e,I.value=n,M.value=e,$.show()},ae=e=>{var n,a,l;f.value=e,j.value=((l=(a=(n=v.value.find(t=>{var o;return(o=t["x-scalar-environments"])==null?void 0:o[e]}))==null?void 0:n["x-scalar-environments"])==null?void 0:a[e])==null?void 0:l.color)??"",E.show()},le=e=>{const n=f.value;typeof n=="string"&&(v.value.some(a=>{var l;return(l=a["x-scalar-environments"])==null?void 0:l[n]})&&v.value.forEach(a=>{var l;(l=a["x-scalar-environments"])!=null&&l[n]&&(a["x-scalar-environments"][n].color=e,u.edit(a.uid,"x-scalar-environments",a["x-scalar-environments"]))}),E.hide())};function oe(e){var n;D.value.forEach(l=>{u.removeEnvironment(e,l.uid)});const a=D.value.flatMap(l=>Object.keys(l["x-scalar-environments"]||{}));if(a.length>0){const l=a[a.length-1];if(!l)return;const t=v.value.find(o=>Object.keys(o["x-scalar-environments"]||{}).includes(l));r.value=l,g.push({name:"environment.collection",params:{[s.Collection]:t?.uid,[s.Environment]:l}}),t&&!h[t.uid]&&x(t.uid)}else r.value="default",g.push({name:"environment.default",params:{[s.Workspace]:(n=c.value)==null?void 0:n.uid}})}const te=()=>r.value==="default"?"Global Environment":r.value,re=()=>{var e,n,a,l;return r.value==="default"?JSON.stringify((e=c.value)==null?void 0:e.environments,null,2):JSON.stringify((l=(a=(n=v.value.find(t=>{var o;return(o=t["x-scalar-environments"])==null?void 0:o[r.value??""]}))==null?void 0:n["x-scalar-environments"])==null?void 0:a[r.value??""])==null?void 0:l.variables,null,2)},ie=e=>h[e],U=e=>{e!=null&&e.createNew&&m.name==="environment"&&N()};G(()=>[m.params[s.Collection],m.params[s.Environment]],([e,n])=>{e?r.value=n:r.value="default"}),ye(()=>{r.value=m.params[s.Environment]||"default",F.hotKeys.on(U);const e=m.params[s.Collection];e&&!h[e]&&x(e)}),ge(()=>F.hotKeys.off(U));const se=(e,n,a)=>{var l,t;const o=a?{name:"environment.collection",params:{[s.Workspace]:(l=c.value)==null?void 0:l.uid,[s.Collection]:a,[s.Environment]:n}}:{name:"environment.default",params:{[s.Workspace]:(t=c.value)==null?void 0:t.uid,[s.Environment]:n}};e.metaKey?window.open(g.resolve(o).href,"_blank"):g.push(o)};function ue(){k.value=void 0,I.value=void 0,M.value=void 0,$.hide()}function ce(e){D.value.some(n=>{const a=Object.keys(n["x-scalar-environments"]||{}).includes(e);return A(a,n,I.value),a})||(e&&k.value!=="default"&&v.value.forEach(n=>{var a;if((a=n["x-scalar-environments"])!=null&&a[k.value??""]){const l=n["x-scalar-environments"],t={};Object.keys(l).forEach(o=>{const p=l[o];p&&(o===k.value?t[e]=p:t[o]=p)}),n["x-scalar-environments"]=t,u.edit(n.uid,"x-scalar-environments",n["x-scalar-environments"])}}),e&&r.value===k.value&&(r.value=e),k.value=void 0,I.value=void 0,M.value=void 0,$.hide())}const{handleDragEnd:ve,isDroppable:de}=Ke(v,u);return G(()=>m.query.openEnvironmentModal,e=>{e==="true"&&N()},{immediate:!0}),(e,n)=>(y(),V(Se,null,{default:b(()=>[d(Fe,{title:"Collections"},{content:b(()=>[C("div",Ae,[d(Ne,null,{default:b(()=>[(y(),V(P,{key:"default",class:"text-xs",isCopyable:!1,to:{name:"environment",params:{[i(s).Environment]:"default"}},type:"environment",variable:{name:"Global Environment",uid:"default",icon:"Globe",isDefault:!0}},null,8,["to"])),(y(!0),R(L,null,X(D.value,a=>{var l;return y(),R("li",{key:a.uid,class:"gap-1/2 flex flex-col"},[C("button",{class:"hover:bg-b-2 group flex w-full items-center gap-1.5 rounded p-1.5 text-left text-sm font-medium break-words",type:"button",onClick:t=>i(x)(a.uid)},[C("span",Ge,[d(i(je),{class:"text-sidebar-c-2 size-3.5 min-w-3.5 stroke-2 group-hover:hidden",src:a["x-scalar-icon"]||"interface-content-folder"},null,8,["src"]),C("div",{class:Y({"rotate-90":i(h)[a.uid]})},[d(i(Z),{class:"text-c-3 hover:text-c-1 hidden text-sm group-hover:block",icon:"ChevronRight",size:"md"})],2)]),J(" "+q(((l=a.info)==null?void 0:l.title)??""),1)],8,Ue),Ce(C("div",{class:Y({"before:bg-border relative mb-[.5px] before:pointer-events-none before:absolute before:top-0 before:left-3 before:z-1 before:h-[calc(100%_+_.5px)] before:w-[.5px] last:mb-0 last:before:h-full":Object.keys(a["x-scalar-environments"]||{}).length>0})},[(y(!0),R(L,null,X(a["x-scalar-environments"],(t,o)=>(y(),V(P,{key:o,class:"text-xs",collectionId:a.uid,isCopyable:!1,isDeletable:!0,isRenameable:!0,isDraggable:!0,isDroppable:i(de),to:{name:"environment.collection",params:{[i(s).Collection]:a.uid,[i(s).Environment]:o}},type:"environment",variable:{name:o,uid:o,color:t.color??"#FFFFFF",isDefault:!1},warningMessage:"Are you sure you want to delete this environment?",onClick:Ee(p=>se(p,o,a.uid),["prevent"]),onColorModal:p=>ae(o),onDelete:p=>oe(o),onRename:p=>ne(o,a.uid),onOnDragEnd:i(ve)},null,8,["collectionId","isDroppable","to","variable","onClick","onColorModal","onDelete","onRename","onOnDragEnd"]))),128)),Object.keys(a["x-scalar-environments"]||{}).length===0?(y(),V(i(we),{key:0,class:"text-c-1 hover:bg-b-2 flex h-8 w-full justify-start gap-1.5 py-0 pl-6 text-xs",variant:"ghost",onClick:t=>N(a.uid)},{default:b(()=>[d(i(Z),{icon:"Add",size:"sm"}),n[2]||(n[2]=C("span",null,"Add Environment",-1))]),_:2,__:[2]},1032,["onClick"])):H("",!0)],2),[[$e,ie(a.uid)]])])}),128))]),_:1})])]),button:b(()=>[d(Me,{click:N,hotkey:"N"},{title:b(()=>n[3]||(n[3]=[J(" Add Environment ")])),_:1})]),_:1}),d(We,{class:"flex-1"},{default:b(()=>[d(ze,null,Ie({default:b(()=>[r.value&&i(c)?(y(),V(De,{key:0,class:"py-2 pr-2 pl-px md:px-4",envVariables:i(S),environment:i(O),language:"json",lineNumbers:"",lint:"",modelValue:re(),workspace:i(c),"onUpdate:modelValue":ee},null,8,["envVariables","environment","modelValue","workspace"])):H("",!0)]),_:2},[r.value?{name:"title",fn:b(()=>[C("span",null,q(te()),1)]),key:"0"}:void 0]),1024)]),_:1}),d(Re,{selectedColor:j.value,state:i(E),onCancel:n[0]||(n[0]=a=>i(E).hide()),onSubmit:le},null,8,["selectedColor","state"]),d(Be,{activeWorkspaceCollections:D.value,collectionId:I.value,state:i(w),onCancel:n[1]||(n[1]=a=>i(w).hide()),onSubmit:T},null,8,["activeWorkspaceCollections","collectionId","state"]),d(i(_e),{size:"xxs",state:i($),title:`Edit ${k.value}`},{default:b(()=>[d(Ve,{name:M.value??"",onClose:ue,onEdit:ce},null,8,["name"])]),_:1},8,["state","title"])]),_:1}))}});export{ln as default};
